import{r as x,j as e,e as H,f as I,u as z,a as M,O as D}from"./index--duSovw8.js";import{O as C,h as L}from"./OperatorsHeader-7q8Nrr1Q.js";import{B as V}from"./LoadingSpinner-4Uf2EpxT.js";import{a as U}from"./Skeleton-KrAfqigt.js";import{S as Y}from"./save-DEAvpU2x.js";function A({label:s,name:l,type:c="text",value:i,onChange:m,onBlur:g,error:N,success:S=!1,required:o=!1,placeholder:w,helpText:u,maxLength:b,rows:v,className:$="",disabled:p=!1,...F}){const a=`field-${l}`,n=!!N,P=S&&!n&&(i||"").toString().trim().length>0,f=`
    w-full px-4 py-2 sm:py-3 text-base border rounded-lg
    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
    transition-colors
    ${n?"border-red-500 bg-red-50 focus:ring-red-500":P?"border-green-500 bg-green-50/30 focus:ring-green-500":"border-gray-300 bg-white"}
    ${p?"bg-gray-100 cursor-not-allowed":""}
  `,j=()=>{switch(c){case"textarea":return e.jsx("textarea",{id:a,name:l,value:i||"",onChange:m,onBlur:g,placeholder:w,required:o,maxLength:b,rows:v||4,disabled:p,className:f,"aria-invalid":n,"aria-describedby":n?`${a}-error`:u?`${a}-help`:void 0,...F});case"select":return e.jsx("select",{id:a,name:l,value:i||"",onChange:m,onBlur:g,required:o,disabled:p,className:f,"aria-invalid":n,"aria-describedby":n?`${a}-error`:u?`${a}-help`:void 0,...F,children:F.children});default:return e.jsx("input",{id:a,name:l,type:c,value:i||"",onChange:m,onBlur:g,placeholder:w,required:o,maxLength:b,disabled:p,className:f,"aria-invalid":n,"aria-describedby":n?`${a}-error`:u?`${a}-help`:void 0,...F})}};return e.jsxs("div",{className:`mb-4 ${$}`,children:[s&&e.jsxs("label",{htmlFor:a,className:"block text-base font-medium text-gray-700 mb-1",children:[s,o&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),j(),b&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 text-right",children:[(i||"").length," / ",b," characters"]}),u&&!n&&e.jsx("p",{id:`${a}-help`,className:"mt-1 text-base text-gray-500",children:u}),P&&e.jsxs("p",{className:"mt-1 flex items-center gap-1 text-sm text-green-600","aria-hidden":"true",children:[e.jsx(H,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:"Looks good"})]}),n&&e.jsxs("div",{id:`${a}-error`,className:"mt-1 flex items-center gap-1 text-sm text-red-600",role:"alert",children:[e.jsx(I,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:N})]})]})}const _=x.memo(A),G=s=>{if(!s)return{valid:!0};try{return new URL(s.startsWith("http")?s:`https://${s}`),{valid:!0}}catch{return{valid:!1,error:"Please enter a valid URL"}}},J=(s,l={})=>{const{maxSize:c=5*1024*1024,allowedTypes:i=[],fieldName:m="File"}=l;if(!s)return{valid:!1,error:`${m} is required`};if(i.length>0&&!i.includes(s.type))return{valid:!1,error:`${m} must be one of: ${i.join(", ")}`};if(s.size>c){const g=(c/1048576).toFixed(1);return{valid:!1,error:`${m} must be smaller than ${g}MB`}}return{valid:!0}},K=s=>s?s.trim().split(/\s+/).filter(c=>c.length>0).length<10?{valid:!1,error:"Bio should be at least 10 words (recommended: 100-200 words)"}:s.length>2e3?{valid:!1,error:"Bio must be no more than 2000 characters"}:{valid:!0}:{valid:!0},T=s=>{const l={},c=K(s.bio);if(c.valid||(l.bio=c.error),s.website_url){const i=G(s.website_url);i.valid||(l.website_url=i.error)}return{valid:Object.keys(l).length===0,errors:l}};function re(){var O;const[s,l]=x.useState(null),[c,i]=x.useState(!0),[m,g]=x.useState(!1),[N,S]=x.useState(!1),[o,w]=x.useState({role_title:"",industry:"",bio:"",headshot_url:"",business_name:"",website_url:""}),[u,b]=x.useState({}),[v,$]=x.useState({}),{email:p,userRoles:F}=z(),a=M(),n=d=>{window.history.pushState({},"",d),window.dispatchEvent(new PopStateEvent("popstate")),window.scrollTo({top:0,behavior:"instant"})};x.useEffect(()=>{(async()=>{if(!p){i(!1);return}try{i(!0);const r=await(await fetch(`/api/operators/users/me?email=${encodeURIComponent(p)}`)).json();r.ok&&r.user&&(l(r.user),w({role_title:r.user.role_title||"",industry:r.user.industry||"",bio:r.user.bio||"",headshot_url:r.user.headshot_url||"",business_name:r.user.business_name||"",website_url:r.user.website_url||""}))}catch(t){console.error("Failed to fetch profile:",t)}finally{i(!1)}})()},[p]);const P=async d=>{var h;const t=(h=d.target.files)==null?void 0:h[0];if(!t)return;const r=J(t,{maxSize:2*1024*1024,allowedTypes:["image/png","image/jpeg","image/jpg"],fieldName:"Headshot"});if(!r.valid){a.error(r.error);return}S(!0);try{const y=new FormData;y.append("file",t),y.append("type","headshot");const k=await(await fetch("/api/operators/upload-headshot",{method:"POST",body:y})).json();k.ok?(w(E=>({...E,headshot_url:k.headshotUrl})),a.success("Headshot uploaded successfully")):a.error(k.error||"Failed to upload headshot")}catch(y){console.error("Failed to upload headshot:",y),a.error("Failed to upload headshot. Please try again.")}finally{S(!1),d.target.value=""}},f=d=>{const{name:t,value:r}=d.target;w(h=>({...h,[t]:r})),u[t]&&b(h=>{const y={...h};return delete y[t],y})},j=d=>{const{name:t}=d.target;$(h=>({...h,[t]:!0}));const r=T({[t]:o[t]});!r.valid&&r.errors[t]&&b(h=>({...h,[t]:r.errors[t]}))},B=async()=>{const d=T(o);if(!d.valid){b(d.errors),$(Object.keys(o).reduce((t,r)=>({...t,[r]:!0}),{})),a.error("Please fix the errors before saving");return}g(!0);try{const r=await(await fetch(`/api/operators/users/me?email=${encodeURIComponent(p)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,...o})})).json();if(r.ok)l(r.user),a.success("Profile updated successfully");else{const h=r.details?`${r.error}: ${r.details}`:r.error||"Failed to update profile";console.error("Profile update error:",r),a.error(h)}}catch(t){console.error("Failed to save profile:",t),a.error("Failed to save profile. Please try again.")}finally{g(!1)}};if(c)return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(C,{active:"profile",onNavigate:n}),e.jsx("div",{id:"main-content",className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12","aria-busy":"true","aria-label":"Loading profile",children:e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 shadow-sm",children:[e.jsx(U,{className:"h-8 mb-6",width:"30%"}),e.jsx(U,{lines:4,className:"h-4"})]})})]});if(!s)return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(C,{active:"profile",onNavigate:n}),e.jsx("div",{id:"main-content",className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsx("p",{className:"text-gray-600",children:"Profile not found"})})]});const R=((O=s.roles)==null?void 0:O.includes("operator"))||!1;return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(C,{active:"profile",onNavigate:n}),e.jsx("div",{id:"main-content",className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 shadow-sm",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Your Profile"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Update your profile information to help generate better topic insights for events."}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(_,{label:"Role Title",name:"role_title",type:"text",value:o.role_title,onChange:f,onBlur:j,error:v.role_title?u.role_title:void 0,placeholder:"e.g., CEO, COO, VP of Operations",helpText:"Your current role or title"}),e.jsx(_,{label:"Industry",name:"industry",type:"text",value:o.industry,onChange:f,onBlur:j,error:v.industry?u.industry:void 0,placeholder:"e.g., Technology, Healthcare, Manufacturing",helpText:"The industry you work in"}),e.jsx(_,{label:"Bio",name:"bio",type:"textarea",value:o.bio,onChange:f,onBlur:j,error:v.bio?u.bio:void 0,placeholder:"Tell us about yourself, your background, and what you're working on. This helps generate more relevant discussion topics for events you attend. (Recommended: 100-200 words)",helpText:`${o.bio.trim()?o.bio.trim().split(/\s+/).filter(d=>d.length>0).length:0} words (Recommended: 100-200 words)`,rows:6,maxLength:2e3}),R&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Operator Profile"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Headshot"}),e.jsxs("div",{className:"flex items-center gap-4",children:[o.headshot_url&&e.jsx(D,{src:o.headshot_url,alt:"Headshot",className:"w-24 h-24 rounded-full object-cover border-2 border-gray-300",width:96,height:96}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:P,disabled:N,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200 disabled:opacity-50","aria-label":"Upload headshot image","aria-describedby":"headshot-help"}),N&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Uploading..."})]})]}),e.jsx("p",{id:"headshot-help",className:"text-xs text-gray-500 mt-1",children:"Upload a low-resolution headshot (PNG or JPG, max 2MB). Image will be automatically cropped and scaled."})]}),e.jsx(_,{label:"Business Name",name:"business_name",type:"text",value:o.business_name,onChange:f,onBlur:j,error:v.business_name?u.business_name:void 0,placeholder:"Your business or company name"}),e.jsx(_,{label:"Website Address",name:"website_url",type:"url",value:o.website_url,onChange:f,onBlur:j,error:v.website_url?u.website_url:void 0,placeholder:"https://example.com",helpText:"Include https:// or http://"})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:e.jsxs("button",{onClick:B,onKeyDown:L(B),disabled:m,className:"min-h-[44px] px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2","aria-label":"Save profile changes",children:[e.jsx(Y,{className:"w-4 h-4","aria-hidden":"true"}),m?e.jsxs(e.Fragment,{children:[e.jsx(V,{})," Saving..."]}):"Save Profile"]})})]})]})})]})}export{re as default};
//# sourceMappingURL=Profile-DiiJdE93.js.map
