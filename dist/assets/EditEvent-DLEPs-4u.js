import{u as T,r as c,j as e}from"./index-BdsrP8-0.js";import{O as v}from"./OperatorsHeader-CU2vonQ4.js";import{a as $,p as B,f as q}from"./input-masks-C2mlJJff.js";function A(){const{email:u,userRoles:y}=T(),m=window.location.pathname.replace("/operators/events/","").replace("/edit",""),[s,h]=c.useState({title:"",event_date:"",start_time:"",finish_time:"",stake_amount:"",max_seats:"",host_name:"",host_logo_url:"",host_location:"",host_location_lat:"",host_location_lng:"",host_description:"",sponsor_name:"",sponsor_logo_url:"",sponsor_website:"",sponsor_phone:"",sponsor_pot_value:"",sponsor_description:""}),[U,x]=c.useState(!0),[S,g]=c.useState(!1),[b,k]=c.useState({host:!1,sponsor:!1}),[f,a]=c.useState(""),[H,E]=c.useState(!1),[j,F]=c.useState(0),[N,D]=c.useState(0),p=n=>{window.history.pushState({},"",n),window.dispatchEvent(new PopStateEvent("popstate")),window.scrollTo({top:0,behavior:"instant"})};c.useEffect(()=>{},[u]),c.useEffect(()=>{(async()=>{var t,r,i,d;if(!m||!u){x(!1);return}try{x(!0);const w=await(await fetch(`/api/operators/events/${m}?email=${encodeURIComponent(u)}`)).json();if(w.ok&&w.event){const o=w.event;if(o.state!=="LIVE"){a("Can only edit LIVE events. This event is already OPEN or CLOSED."),x(!1);return}const I=new Date(o.event_date),P=new Date;if(P.setHours(0,0,0,0),I<P){a("Can only edit future events."),x(!1);return}h({title:o.title||"",event_date:o.event_date||"",start_time:o.start_time||"",finish_time:o.finish_time||"",stake_amount:((t=o.stake_amount)==null?void 0:t.toString())||"",max_seats:((r=o.max_seats)==null?void 0:r.toString())||"",host_name:o.host_name||"",host_logo_url:o.host_logo_url||"",host_location:o.host_location||"",host_location_lat:((i=o.host_location_lat)==null?void 0:i.toString())||"",host_location_lng:((d=o.host_location_lng)==null?void 0:d.toString())||"",host_description:o.host_description||"",sponsor_name:o.sponsor_name||"",sponsor_logo_url:o.sponsor_logo_url||"",sponsor_website:o.sponsor_website||"",sponsor_phone:o.sponsor_phone||"",sponsor_pot_value:o.sponsor_pot_value?$((o.sponsor_pot_value*100).toString()):"",sponsor_description:o.sponsor_description||""}),o.host_description&&F(o.host_description.trim().split(/\s+/).filter(C=>C.length>0).length),o.sponsor_description&&D(o.sponsor_description.trim().split(/\s+/).filter(C=>C.length>0).length)}else a("Event not found")}catch(_){console.error("Failed to fetch event:",_),a("Failed to load event")}finally{x(!1)}})()},[m,u]);const L=async(n,t)=>{if(t){if(!["image/png","image/jpeg","image/jpg"].includes(t.type.toLowerCase())){a("Logo must be PNG or JPG format");return}if(t.size>2*1024*1024){a("Logo file size must be less than 2MB");return}k(r=>({...r,[n]:!0})),a("");try{const r=new FormData;r.append("logoType",n),r.append("file",t);const d=await(await fetch("/api/operators/upload-logo",{method:"POST",body:r})).json();d.ok?h(_=>({..._,[`${n}_logo_url`]:d.logoUrl})):a(d.error||"Failed to upload logo")}catch(r){a("Failed to upload logo. Please try again."),console.error("Logo upload error:",r)}finally{k(r=>({...r,[n]:!1}))}}},O=async n=>{if(n.preventDefault(),g(!0),a(""),E(!1),s.start_time&&s.finish_time&&s.finish_time<=s.start_time){a("Finish time must be after start time"),g(!1);return}if(s.host_description&&s.host_description.trim().split(/\s+/).length>150){a("Host description must be 150 words or less"),g(!1);return}if(s.sponsor_description&&s.sponsor_description.trim().split(/\s+/).length>150){a("Sponsor description must be 150 words or less"),g(!1);return}try{const r=await(await fetch(`/api/operators/events/${m}/update`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:u,...s,stake_amount:parseFloat(s.stake_amount),max_seats:parseInt(s.max_seats),sponsor_pot_value:s.sponsor_pot_value?B(s.sponsor_pot_value):0,host_location_lat:s.host_location_lat||null,host_location_lng:s.host_location_lng||null})})).json();r.ok?(E(!0),setTimeout(()=>{p(`/operators/events/${m}`)},1500)):a(r.error||"Failed to update event")}catch(t){a("Failed to update event. Please try again."),console.error("Update event error:",t)}finally{g(!1)}},l=n=>{const{name:t,value:r}=n.target;if(t==="sponsor_phone")h(i=>({...i,[t]:q(r)}));else if(t==="sponsor_pot_value")h(i=>({...i,[t]:$(r)}));else if(h(i=>({...i,[t]:r})),t==="host_description"){const i=r.trim().split(/\s+/).filter(d=>d.length>0).length;F(i)}else if(t==="sponsor_description"){const i=r.trim().split(/\s+/).filter(d=>d.length>0).length;D(i)}};return!y||!y.includes("chief_operator")&&!y.includes("super_admin")?e.jsxs("div",{className:"min-h-screen bg-[#fafafa]",children:[e.jsx(v,{active:"events",onNavigate:p}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 p-6 shadow-sm",children:e.jsx("p",{className:"text-gray-600",children:"Only Chief Operators can edit events."})})})]}):U?e.jsxs("div",{className:"min-h-screen bg-[#fafafa]",children:[e.jsx(v,{active:"events",onNavigate:p}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:e.jsx("div",{className:"text-center py-12",children:"Loading event..."})})]}):f&&!s.title?e.jsxs("div",{className:"min-h-screen bg-[#fafafa]",children:[e.jsx(v,{active:"events",onNavigate:p}),e.jsx("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:e.jsxs("div",{className:"bg-white rounded-xl border border-red-200 p-6 shadow-sm",children:[e.jsx("p",{className:"text-red-600",children:f}),e.jsx("button",{onClick:()=>p(`/operators/events/${m}`),className:"mt-4 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Back to Event"})]})})]}):e.jsxs("div",{className:"min-h-screen bg-[#fafafa]",children:[e.jsx(v,{active:"events",onNavigate:p}),e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("button",{onClick:()=>p(`/operators/events/${m}`),className:"text-blue-600 hover:text-blue-700 mb-4",children:"â† Back to Event"}),e.jsx("h1",{className:"text-3xl font-semibold text-gray-900",children:"Edit Event"})]}),e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 shadow-sm max-w-4xl",children:[H&&e.jsx("div",{className:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg text-green-800",children:"Event updated successfully! Redirecting..."}),f&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-800",children:f}),e.jsxs("form",{onSubmit:O,className:"space-y-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Event Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Title *"}),e.jsx("input",{type:"text",id:"title",name:"title",required:!0,value:s.title,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., February 2026 Operators Meeting"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"event_date",className:"block text-sm font-medium text-gray-700 mb-2",children:"Event Date *"}),e.jsx("input",{type:"date",id:"event_date",name:"event_date",required:!0,value:s.event_date,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"start_time",className:"block text-sm font-medium text-gray-700 mb-2",children:"Start Time *"}),e.jsx("input",{type:"time",id:"start_time",name:"start_time",required:!0,value:s.start_time,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"finish_time",className:"block text-sm font-medium text-gray-700 mb-2",children:"Finish Time *"}),e.jsx("input",{type:"time",id:"finish_time",name:"finish_time",required:!0,value:s.finish_time,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max_seats",className:"block text-sm font-medium text-gray-700 mb-2",children:"Max Seats *"}),e.jsx("input",{type:"number",id:"max_seats",name:"max_seats",required:!0,min:"1",value:s.max_seats,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"20"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"stake_amount",className:"block text-sm font-medium text-gray-700 mb-2",children:"Stake Amount ($) *"}),e.jsx("input",{type:"number",id:"stake_amount",name:"stake_amount",required:!0,min:"0",step:"0.01",value:s.stake_amount,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"50.00"})]})]})]}),e.jsxs("section",{className:"border-t pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Host Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"host_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Host Name"}),e.jsx("input",{type:"text",id:"host_name",name:"host_name",value:s.host_name,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., Acme Corporation"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Host Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:n=>{const t=n.target.files[0];t&&L("host",t)},className:"text-sm text-gray-600",disabled:b.host}),b.host&&e.jsx("span",{className:"text-sm text-gray-500",children:"Uploading..."}),s.host_logo_url&&e.jsx("img",{src:s.host_logo_url,alt:"Host logo",className:"h-12 w-auto"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PNG or JPG, max 2MB. Recommended: 200x200px"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"host_location",className:"block text-sm font-medium text-gray-700 mb-2",children:"Host Location (Address)"}),e.jsx("input",{type:"text",id:"host_location",name:"host_location",value:s.host_location,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter business name or full address"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Enter business name or full address"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"host_description",className:"block text-sm font-medium text-gray-700 mb-2",children:["Host Description",j>0&&e.jsxs("span",{className:`ml-2 text-sm ${j>150?"text-red-600":"text-gray-500"}`,children:["(",j,"/150 words)"]})]}),e.jsx("textarea",{id:"host_description",name:"host_description",rows:"4",value:s.host_description,onChange:l,maxLength:1e3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of the host (150 words max)"})]})]})]}),e.jsxs("section",{className:"border-t pt-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Sponsor Information (Optional)"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sponsor_name",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor Name"}),e.jsx("input",{type:"text",id:"sponsor_name",name:"sponsor_name",value:s.sponsor_name,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"e.g., TechCorp Inc"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor Logo"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:n=>{const t=n.target.files[0];t&&L("sponsor",t)},className:"text-sm text-gray-600",disabled:b.sponsor}),b.sponsor&&e.jsx("span",{className:"text-sm text-gray-500",children:"Uploading..."}),s.sponsor_logo_url&&e.jsx("img",{src:s.sponsor_logo_url,alt:"Sponsor logo",className:"h-12 w-auto"})]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"PNG or JPG, max 2MB. Recommended: 200x200px"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sponsor_website",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor Website"}),e.jsx("input",{type:"url",id:"sponsor_website",name:"sponsor_website",value:s.sponsor_website,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"https://example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sponsor_phone",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor Phone"}),e.jsx("input",{type:"tel",id:"sponsor_phone",name:"sponsor_phone",value:s.sponsor_phone,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"(555) 123-4567"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"sponsor_pot_value",className:"block text-sm font-medium text-gray-700 mb-2",children:"Sponsor Pot Value ($)"}),e.jsx("input",{type:"text",id:"sponsor_pot_value",name:"sponsor_pot_value",value:s.sponsor_pot_value,onChange:l,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Additional contribution to the pot for this event"})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"sponsor_description",className:"block text-sm font-medium text-gray-700 mb-2",children:["Sponsor Description",N>0&&e.jsxs("span",{className:`ml-2 text-sm ${N>150?"text-red-600":"text-gray-500"}`,children:["(",N,"/150 words)"]})]}),e.jsx("textarea",{id:"sponsor_description",name:"sponsor_description",rows:"4",value:s.sponsor_description,onChange:l,maxLength:1e3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Brief description of the sponsor (150 words max)"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4 border-t",children:[e.jsx("button",{type:"submit",disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Saving...":"Save Changes"}),e.jsx("button",{type:"button",onClick:()=>p(`/operators/events/${m}`),className:"px-6 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300",children:"Cancel"})]})]})]})]})]})}export{A as default};
//# sourceMappingURL=EditEvent-DLEPs-4u.js.map
