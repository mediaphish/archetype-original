import{r as x,j as e,f as E,u as H,a as I}from"./index-BKlGytab.js";import{O as U,h as M}from"./OperatorsHeader-C57u4AA7.js";import{S as z}from"./save-Cvs8QxzP.js";function D({label:s,name:l,type:c="text",value:i,onChange:m,onBlur:g,error:N,required:y=!1,placeholder:o,helpText:f,maxLength:h,rows:F,className:v="",disabled:j=!1,...p}){const d=`field-${l}`,a=!!N,w=`
    w-full px-4 py-2 border rounded-lg
    focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent
    transition-colors
    ${a?"border-red-500 bg-red-50 focus:ring-red-500":"border-gray-300 bg-white"}
    ${j?"bg-gray-100 cursor-not-allowed":""}
  `,S=()=>{switch(c){case"textarea":return e.jsx("textarea",{id:d,name:l,value:i||"",onChange:m,onBlur:g,placeholder:o,required:y,maxLength:h,rows:F||4,disabled:j,className:w,"aria-invalid":a,"aria-describedby":a?`${d}-error`:f?`${d}-help`:void 0,...p});case"select":return e.jsx("select",{id:d,name:l,value:i||"",onChange:m,onBlur:g,required:y,disabled:j,className:w,"aria-invalid":a,"aria-describedby":a?`${d}-error`:f?`${d}-help`:void 0,...p,children:p.children});default:return e.jsx("input",{id:d,name:l,type:c,value:i||"",onChange:m,onBlur:g,placeholder:o,required:y,maxLength:h,disabled:j,className:w,"aria-invalid":a,"aria-describedby":a?`${d}-error`:f?`${d}-help`:void 0,...p})}};return e.jsxs("div",{className:`mb-4 ${v}`,children:[s&&e.jsxs("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700 mb-1",children:[s,y&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),S(),h&&e.jsxs("div",{className:"mt-1 text-xs text-gray-500 text-right",children:[(i||"").length," / ",h," characters"]}),f&&!a&&e.jsx("p",{id:`${d}-help`,className:"mt-1 text-sm text-gray-500",children:f}),a&&e.jsxs("div",{id:`${d}-error`,className:"mt-1 flex items-center gap-1 text-sm text-red-600",role:"alert",children:[e.jsx(E,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:N})]})]})}const P=x.memo(D),L=s=>{if(!s)return{valid:!0};try{return new URL(s.startsWith("http")?s:`https://${s}`),{valid:!0}}catch{return{valid:!1,error:"Please enter a valid URL"}}},V=(s,l={})=>{const{maxSize:c=5*1024*1024,allowedTypes:i=[],fieldName:m="File"}=l;if(!s)return{valid:!1,error:`${m} is required`};if(i.length>0&&!i.includes(s.type))return{valid:!1,error:`${m} must be one of: ${i.join(", ")}`};if(s.size>c){const g=(c/1048576).toFixed(1);return{valid:!1,error:`${m} must be smaller than ${g}MB`}}return{valid:!0}},Y=s=>s?s.trim().split(/\s+/).filter(c=>c.length>0).length<10?{valid:!1,error:"Bio should be at least 10 words (recommended: 100-200 words)"}:s.length>2e3?{valid:!1,error:"Bio must be no more than 2000 characters"}:{valid:!0}:{valid:!0},B=s=>{const l={},c=Y(s.bio);if(c.valid||(l.bio=c.error),s.website_url){const i=L(s.website_url);i.valid||(l.website_url=i.error)}return{valid:Object.keys(l).length===0,errors:l}};function W(){var T;const[s,l]=x.useState(null),[c,i]=x.useState(!0),[m,g]=x.useState(!1),[N,y]=x.useState(!1),[o,f]=x.useState({role_title:"",industry:"",bio:"",headshot_url:"",business_name:"",website_url:""}),[h,F]=x.useState({}),[v,j]=x.useState({}),{email:p,userRoles:d}=H(),a=I(),w=n=>{window.history.pushState({},"",n),window.dispatchEvent(new PopStateEvent("popstate")),window.scrollTo({top:0,behavior:"instant"})};x.useEffect(()=>{(async()=>{if(!p){i(!1);return}try{i(!0);const r=await(await fetch(`/api/operators/users/me?email=${encodeURIComponent(p)}`)).json();r.ok&&r.user&&(l(r.user),f({role_title:r.user.role_title||"",industry:r.user.industry||"",bio:r.user.bio||"",headshot_url:r.user.headshot_url||"",business_name:r.user.business_name||"",website_url:r.user.website_url||""}))}catch(t){console.error("Failed to fetch profile:",t)}finally{i(!1)}})()},[p]);const S=async n=>{var u;const t=(u=n.target.files)==null?void 0:u[0];if(!t)return;const r=V(t,{maxSize:2*1024*1024,allowedTypes:["image/png","image/jpeg","image/jpg"],fieldName:"Headshot"});if(!r.valid){a.error(r.error);return}y(!0);try{const b=new FormData;b.append("file",t),b.append("type","headshot");const C=await(await fetch("/api/operators/upload-headshot",{method:"POST",body:b})).json();C.ok?(f(R=>({...R,headshot_url:C.headshotUrl})),a.success("Headshot uploaded successfully")):a.error(C.error||"Failed to upload headshot")}catch(b){console.error("Failed to upload headshot:",b),a.error("Failed to upload headshot. Please try again.")}finally{y(!1),n.target.value=""}},_=n=>{const{name:t,value:r}=n.target;f(u=>({...u,[t]:r})),h[t]&&F(u=>{const b={...u};return delete b[t],b})},$=n=>{const{name:t}=n.target;j(u=>({...u,[t]:!0}));const r=B({[t]:o[t]});!r.valid&&r.errors[t]&&F(u=>({...u,[t]:r.errors[t]}))},k=async()=>{const n=B(o);if(!n.valid){F(n.errors),j(Object.keys(o).reduce((t,r)=>({...t,[r]:!0}),{})),a.error("Please fix the errors before saving");return}g(!0);try{const r=await(await fetch(`/api/operators/users/me?email=${encodeURIComponent(p)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:p,...o})})).json();if(r.ok)l(r.user),a.success("Profile updated successfully");else{const u=r.details?`${r.error}: ${r.details}`:r.error||"Failed to update profile";console.error("Profile update error:",r),a.error(u)}}catch(t){console.error("Failed to save profile:",t),a.error("Failed to save profile. Please try again.")}finally{g(!1)}};if(c)return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(U,{active:"profile",onNavigate:w}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-12",children:e.jsx("p",{className:"text-gray-600",children:"Loading profile..."})})]});if(!s)return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(U,{active:"profile",onNavigate:w}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-12",children:e.jsx("p",{className:"text-gray-600",children:"Profile not found"})})]});const O=((T=s.roles)==null?void 0:T.includes("operator"))||!1;return e.jsxs("div",{className:"min-h-screen bg-[#F5F3F0]",children:[e.jsx(U,{active:"profile",onNavigate:w}),e.jsx("div",{className:"max-w-4xl mx-auto px-6 py-12",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 shadow-sm",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Your Profile"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Update your profile information to help generate better topic insights for events."}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(P,{label:"Role Title",name:"role_title",type:"text",value:o.role_title,onChange:_,onBlur:$,error:v.role_title?h.role_title:void 0,placeholder:"e.g., CEO, COO, VP of Operations",helpText:"Your current role or title"}),e.jsx(P,{label:"Industry",name:"industry",type:"text",value:o.industry,onChange:_,onBlur:$,error:v.industry?h.industry:void 0,placeholder:"e.g., Technology, Healthcare, Manufacturing",helpText:"The industry you work in"}),e.jsx(P,{label:"Bio",name:"bio",type:"textarea",value:o.bio,onChange:_,onBlur:$,error:v.bio?h.bio:void 0,placeholder:"Tell us about yourself, your background, and what you're working on. This helps generate more relevant discussion topics for events you attend. (Recommended: 100-200 words)",helpText:`${o.bio.trim()?o.bio.trim().split(/\s+/).filter(n=>n.length>0).length:0} words (Recommended: 100-200 words)`,rows:6,maxLength:2e3}),O&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Operator Profile"})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Headshot"}),e.jsxs("div",{className:"flex items-center gap-4",children:[o.headshot_url&&e.jsx("img",{src:o.headshot_url,alt:"Headshot",className:"w-24 h-24 rounded-full object-cover border-2 border-gray-300"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:"image/png,image/jpeg,image/jpg",onChange:S,disabled:N,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-gray-100 file:text-gray-700 hover:file:bg-gray-200 disabled:opacity-50","aria-label":"Upload headshot image","aria-describedby":"headshot-help"}),N&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Uploading..."})]})]}),e.jsx("p",{id:"headshot-help",className:"text-xs text-gray-500 mt-1",children:"Upload a low-resolution headshot (PNG or JPG, max 2MB). Image will be automatically cropped and scaled."})]}),e.jsx(P,{label:"Business Name",name:"business_name",type:"text",value:o.business_name,onChange:_,onBlur:$,error:v.business_name?h.business_name:void 0,placeholder:"Your business or company name"}),e.jsx(P,{label:"Website Address",name:"website_url",type:"url",value:o.website_url,onChange:_,onBlur:$,error:v.website_url?h.website_url:void 0,placeholder:"https://example.com",helpText:"Include https:// or http://"})]}),e.jsx("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-gray-200",children:e.jsxs("button",{onClick:k,onKeyDown:M(k),disabled:m,className:"px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2","aria-label":"Save profile changes",children:[e.jsx(z,{className:"w-4 h-4","aria-hidden":"true"}),m?"Saving...":"Save Profile"]})})]})]})})]})}export{W as default};
//# sourceMappingURL=Profile-B2wJcRCh.js.map
